...
  <!-- Telemetry Logs -->
  <div class="card" id="logsWrapper">
    <h1>Telemetry Log</h1>
    <div id="logsContainer"></div>
  </div>

  <!-- ✅ GNSS Logs -->
  <div class="card" id="gnssLogsWrapper">
    <h1>GNSS Log</h1>
    <div id="gnssLogsContainer"></div>
  </div>
</div>

<script>
const ROVER_ID = "rover1";
const speedMap = {1:"0.5 kmph",2:"1 kmph",3:"1.5 kmph",4:"2 kmph",5:"2.5 kmph"};
const steeringMap = {1:"Home position",2:"All wheel mode",3:"Zero turn",4:"Crab"};
const shearingMap = {0:"Home position",1:"Sensing position"};

function isHeartbeatValid(hb) {
  return hb >= 1 && hb <= 255;
}

async function fetchRoverData() {
  let res = await fetch(`/rover/${ROVER_ID}`);
  let data = await res.json();
  if (data.success) {
    let d = data.data;
    document.getElementById("mode").innerText = d.mode ?? 0;
    document.getElementById("speed").innerText = speedMap[d.speed] ?? d.speed ?? 0;
    document.getElementById("shearingarm").innerText = shearingMap[d.shearingarm] ?? d.shearingarm ?? 0;
    document.getElementById("angle").innerText = (d.angle ?? 0) + "°";
    document.getElementById("steeringmode").innerText = steeringMap[d.steeringmode] ?? d.steeringmode ?? 0;
    document.getElementById("joystick").innerText = d.joystick ?? 0;
    document.getElementById("heartbeat").innerText = d.heartbeat ?? 0;
    let statusEl = document.getElementById("status");
    if (isHeartbeatValid(d.heartbeat)) {
      statusEl.innerText = "Connected";
      statusEl.className = "status connected";
    } else {
      statusEl.innerText = "Disconnected";
      statusEl.className = "status disconnected";
    }
    document.getElementById("lastupdate").innerText = new Date().toLocaleTimeString();
  }
}

async function fetchRoverLogs() {
  let res = await fetch(`/rover-logs/${ROVER_ID}`);
  let json = await res.json();
  let logs = json.data ?? [];
  let container = document.getElementById("logsContainer");
  container.innerHTML = "";
  logs.forEach(log=>{
    let ts = "--";
    if (log.timestamp) {
      if (log.timestamp.seconds) ts = new Date(log.timestamp.seconds*1000).toLocaleTimeString();
      else if (log.timestamp._seconds) ts = new Date(log.timestamp._seconds*1000).toLocaleTimeString();
      else ts = new Date(log.timestamp).toLocaleTimeString();
    }
    let entry=document.createElement("div");
    entry.className="log-entry";
    let header=document.createElement("div");
    header.className="log-header";
    let tsEl=document.createElement("span");
    tsEl.className="log-timestamp";
    tsEl.innerText=ts;
    let hbValid = isHeartbeatValid(log.heartbeat);
    let statusEl=document.createElement("span");
    statusEl.className="log-status " + (hbValid ? "connected-status":"disconnected-status");
    statusEl.innerText=hbValid ? "Connected" : "Disconnected";
    header.appendChild(tsEl);
    header.appendChild(statusEl);
    entry.appendChild(header);
    let details=document.createElement("div");
    details.className="log-details";
    let fields=[ 
      ["Mode:", log.mode ?? 0],
      ["Speed:", speedMap[log.speed] ?? log.speed ?? 0],
      ["Shearing Arm:", shearingMap[log.shearingarm] ?? log.shearingarm ?? 0],
      ["Steering Angle:", (log.angle ?? 0) + "°"],
      ["Steering Mode:", steeringMap[log.steeringmode] ?? log.steeringmode ?? 0],
      ["Joystick:", log.joystick ?? 0],
      ["Heartbeat:", hbValid ? log.heartbeat : "-"]
    ];
    fields.forEach(f=>{
      let div=document.createElement("div");
      let l=document.createElement("span");
      l.className="log-row-label";
      l.innerText=f[0];
      let v=document.createElement("span");
      v.className="log-row-value";
      v.innerText=f[1];
      div.appendChild(l);
      div.appendChild(v);
      details.appendChild(div);
    });
    entry.appendChild(details);
    container.appendChild(entry);
  });
}

// ✅ Fetch GNSS logs
async function fetchGnssLogs() {
  let res = await fetch(`/gnss-logs/${ROVER_ID}`);
  let json = await res.json();
  let logs = json.data ?? [];
  let container = document.getElementById("gnssLogsContainer");
  container.innerHTML = "";
  logs.forEach(log=>{
    let ts = "--";
    if (log.timestamp) {
      if (log.timestamp.seconds) ts = new Date(log.timestamp.seconds*1000).toLocaleTimeString();
      else if (log.timestamp._seconds) ts = new Date(log.timestamp._seconds*1000).toLocaleTimeString();
      else ts = new Date(log.timestamp).toLocaleTimeString();
    }
    let entry=document.createElement("div");
    entry.className="log-entry";
    let header=document.createElement("div");
    header.className="log-header";
    let tsEl=document.createElement("span");
    tsEl.className="log-timestamp";
    tsEl.innerText=ts;
    header.appendChild(tsEl);
    entry.appendChild(header);
    let details=document.createElement("div");
    details.className="log-details";
    let fields=[ 
      ["Latitude:", log.lat ?? "N/A"],
      ["Longitude:", log.lon ?? "N/A"],
      ["Altitude:", log.alt ?? "N/A"],
      ["Speed:", log.speed ?? "N/A"],
      ["UTC:", log.utc ?? "N/A"]
    ];
    fields.forEach(f=>{
      let div=document.createElement("div");
      let l=document.createElement("span");
      l.className="log-row-label";
      l.innerText=f[0];
      let v=document.createElement("span");
      v.className="log-row-value";
      v.innerText=f[1];
      div.appendChild(l);
      div.appendChild(v);
      details.appendChild(div);
    });
    entry.appendChild(details);
    container.appendChild(entry);
  });
}

setInterval(fetchRoverData,2000);
setInterval(fetchRoverLogs,4000);
setInterval(fetchGnssLogs,5000); // ✅ GNSS refresh
fetchRoverData();
fetchRoverLogs();
fetchGnssLogs();
</script>
</body>
</html>
